program Mir2;

procedure _exit;
begin
  This_Npc.CloseDialog(This_Player);
end;

procedure _zong3;
begin
  This_Npc.NpcDialog(This_Player, '在释放魔族指令书时，用魔法投掷骰子的总和为3\' +
    '魔龙战将将会被释放出来，你可要小心了。\' +
    '|{cmd}<返回上一页/@chakan>\' +
    '|{cmd}<返回对话/@mimi>\' +
    '|{cmd}<退出对话/@exit>');
end;

procedure _zong4;
begin
  This_Npc.NpcDialog(This_Player, '在释放魔族指令书时，用魔法投掷骰子的总和为4\' +
    '魔龙战将将会被释放出来，你可要小心了。\' +
    '|{cmd}<返回上一页/@chakan>\' +
    '|{cmd}<返回对话/@mimi>\' +
    '|{cmd}<退出对话/@exit>');
end;

procedure _zong5;
begin
  This_Npc.NpcDialog(This_Player, '在释放魔族指令书时，用魔法投掷骰子的总和为5\' +
    '魔龙巨蛾将会被释放出来，你可要小心了。\' +
    '|{cmd}<返回上一页/@chakan>\' +
    '|{cmd}<返回对话/@mimi>\' +
    '|{cmd}<退出对话/@exit>');
end;

procedure _zong6;
begin
  This_Npc.NpcDialog(This_Player, '在释放魔族指令书时，用魔法投掷骰子的总和为6\' +
    '魔龙战将将会被释放出来，你可要小心了。\' +
    '|{cmd}<返回上一页/@chakan>\' +
    '|{cmd}<返回对话/@mimi>\' +
    '|{cmd}<退出对话/@exit>');
end;

procedure _zong7;
begin
  This_Npc.NpcDialog(This_Player, '在释放魔族指令书时，用魔法投掷骰子的总和为7\' +
    '魔龙力士将会被释放出来，你可要小心了。\' +
    '|{cmd}<返回上一页/@chakan>\' +
    '|{cmd}<返回对话/@mimi>\' +
    '|{cmd}<退出对话/@exit>');
end;

procedure _zong8;
begin
  This_Npc.NpcDialog(This_Player, '在释放魔族指令书时，用魔法投掷骰子的总和为8\' +
    '双头血魔将会被释放出来，你可要小心了。\' +
    '|{cmd}<返回上一页/@chakan>\' +
    '|{cmd}<返回对话/@mimi>\' +
    '|{cmd}<退出对话/@exit>');
end;

procedure _zong9;
begin
  This_Npc.NpcDialog(This_Player, '在释放魔族指令书时，用魔法投掷骰子的总和为9\' +
    '白野猪将会被释放出来，你可要小心了。\' +
    '|{cmd}<返回上一页/@chakan>\' +
    '|{cmd}<返回对话/@mimi>\' +
    '|{cmd}<退出对话/@exit>');
end;

procedure _zong10;
begin
  This_Npc.NpcDialog(This_Player, '在释放魔族指令书时，用魔法投掷骰子的总和为10\' +
    '黄泉教主将会被释放出来，你可要小心了。\' +
    '|{cmd}<返回上一页/@chakan>\' +
    '|{cmd}<返回对话/@mimi>\' +
    '|{cmd}<退出对话/@exit>');
end;

procedure _zong11;
begin
  This_Npc.NpcDialog(This_Player, '在释放魔族指令书时，用魔法投掷骰子的总和为11\' +
    '虹魔教主将会被释放出来，你可要小心了。\' +
    '|{cmd}<返回上一页/@chakan>\' +
    '|{cmd}<返回对话/@mimi>\' +
    '|{cmd}<退出对话/@exit>');
end;

procedure _zong12;
begin
  This_Npc.NpcDialog(This_Player, '在释放魔族指令书时，用魔法投掷骰子的总和为12\' +
    '你将会得到祝福油。\' +
    '|{cmd}<返回上一页/@chakan>\' +
    '|{cmd}<返回对话/@mimi>\' +
    '|{cmd}<退出对话/@exit>');
end;

procedure _zong13;
begin
  This_Npc.NpcDialog(This_Player, '在释放魔族指令书时，用魔法投掷骰子的总和为13\' +
    '电僵王将会被释放出来，你可要小心了。\' +
    '|{cmd}<返回上一页/@chakan>\' +
    '|{cmd}<返回对话/@mimi>\' +
    '|{cmd}<退出对话/@exit>');
end;

procedure _zong14;
begin
  This_Npc.NpcDialog(This_Player, '在释放魔族指令书时，用魔法投掷骰子的总和为14\' +
    '牛魔王将会被释放出来，你可要小心了。\' +
    '|{cmd}<返回上一页/@chakan>\' +
    '|{cmd}<返回对话/@mimi>\' +
    '|{cmd}<退出对话/@exit>');
end;

procedure _zong15;
begin
  This_Npc.NpcDialog(This_Player, '在释放魔族指令书时，用魔法投掷骰子的总和为15\' +
    '魔龙教主将会被释放出来，你可要小心了。\' +
    '|{cmd}<返回上一页/@chakan>\' +
    '|{cmd}<返回对话/@mimi>\' +
    '|{cmd}<退出对话/@exit>');
end;

procedure _zong16;
begin
  This_Npc.NpcDialog(This_Player, '在释放魔族指令书时，用魔法投掷骰子的总和为16\' +
    '双头血魔将会被释放出来，你可要小心了。\' +
    '|{cmd}<返回上一页/@chakan>\' +
    '|{cmd}<返回对话/@mimi>\' +
    '|{cmd}<退出对话/@exit>');
end;

procedure _zong17;
begin
  This_Npc.NpcDialog(This_Player, '在释放魔族指令书时，用魔法投掷骰子的总和为17\' +
    '魔龙巨蛾将会被释放出来，你可要小心了。\' +
    '|{cmd}<返回上一页/@chakan>\' +
    '|{cmd}<返回对话/@mimi>\' +
    '|{cmd}<退出对话/@exit>');
end;

procedure _zong18;
begin
  This_Npc.NpcDialog(This_Player, '在释放魔族指令书时，用魔法投掷骰子的总和为18\' +
    '魔龙巨蛾将会被释放出来，你可要小心了。\' +
    '|{cmd}<返回上一页/@chakan>\' +
    '|{cmd}<返回对话/@mimi>\' +
    '|{cmd}<退出对话/@exit>');
end;

procedure _next;
begin
  This_Npc.NpcDialog(This_Player,
    '魔族指令书也是魔族专用的密码，\' +
    '配合有法力的骰子投掷，就能解读出密码。\' +
    '现在就告诉你骰子与魔族密码的对应关系吧。\' +
    '|{cmd}<骰子总和为11/@zong11>      ^<骰子总和为12/@zong12>\' +
    '|{cmd}<骰子总和为13/@zong13>      ^<骰子总和为14/@zong14>\' +
    '|{cmd}<骰子总和为15/@zong15>      ^<骰子总和为16/@zong16>\' +
    '|{cmd}<骰子总和为17/@zong17>      ^<骰子总和为18/@zong18>\' +
    '|{cmd}<返回上一页/@chakan>\' +
    '|{cmd}<返回对话/@mimi>');
end;

procedure _chakan;
begin
  This_Npc.NpcDialog(This_Player,
    '魔族指令书也是魔族专用的密码，\' +
    '配合有法力的骰子投掷，就能解读出密码。\' +
    '现在就告诉你骰子与魔族密码的对应关系吧。\' +
    '|{cmd}<骰子总和为3/@zong3>      ^<骰子总和为4/@zong4>\' +
    '|{cmd}<骰子总和为5/@zong5>      ^<骰子总和为6/@zong6>\' +
    '|{cmd}<骰子总和为7/@zong7>      ^<骰子总和为8/@zong8>\' +
    '|{cmd}<骰子总和为9/@zong9>      ^<骰子总和为10/@zong10>\' +
    '|{cmd}<下一页/@next>\' +
    '|{cmd}<返回对话/@mimi> ');
end;

procedure _mimi;
begin
  if This_Player.GetBagItemCount('魔族指令书') > 0 then
  begin
    This_Npc.NpcDialog(This_Player,
      '你听说过吗？传说中魔龙套装是可以升级的！\' +
      '但我只知道关于腰带和鞋子的升级秘密。\' +
      '升级腰带和鞋子的材料，就在魔族指令书里！\' +
      '为了感谢你的帮助，我愿意用我的法力帮你释放。\' +
      '每张魔族指令书，配合骰子投掷，可以决定释放结果。\' +
      '释放的结果是获得宝物还是出现怪物，就看你的运气了\' +
      '|{cmd}<关于魔族指令书/@chakan>         ^<释放魔族指令书/@gonext>\ \' +
      '|{cmd}<返回宫殿/@goh006>');
  end
  else
  begin
    This_Npc.NpcDialog(This_Player,
      '为了收集上等的材料，我整天出入地下城与妖魔为伍。\' +
      '|{cmd}<返回宫殿/@goh006> \' +
      '|{cmd}<退出对话/@exit>');
  end;
end;

procedure _goh006;
begin
  if LowerCase(This_Player.DynRoomName) = 'godforfex' then
  begin
    if This_Player.IsGroupOwner then
      This_Player.GroupFly('DM002~1')
    else
      This_Player.FlyTo('DM002~1', 0, 0);
  end;
end;

procedure _cube;
var
  nDice1, nDice2, nDice3, nSum: Integer;
  sMonName, sMonDesc: string;
begin
  if This_Player.GetV(26, 9) <> 1 then
  begin
    This_Npc.NpcDialog(This_Player,
      '投掷骰子来决定释放魔族指令书的结果吧\' +
      '你还没有掷骰子呢\');
  end
  else
  begin
    nDice1 := This_Player.GetV(0, 1);
    nDice2 := This_Player.GetV(0, 2);
    nDice3 := This_Player.GetV(0, 3);
    nSum := nDice1 + nDice2 + nDice3;
    case nSum of
      3, 4:
        begin
          sMonDesc := '魔龙战将';
          case Random(3) of
            0: sMonName := '魔龙战将700';
            1: sMonName := '魔龙战将800';
            2: sMonName := '魔龙战将900';
          end;
        end;
      5:
        begin
          sMonName := '魔龙巨蛾';
          sMonDesc := '魔龙巨蛾';
        end;
      6:
        begin
          sMonName := '魔龙战将';
          sMonDesc := '魔龙战将';
        end;
      7:
        begin
          sMonName := '魔龙力士';
          sMonDesc := '魔龙力士';
        end;
      8:
        begin
          sMonName := '双头血魔';
          sMonDesc := '双头血魔';
        end;
      9:
        begin
          sMonName := '白野猪';
          sMonDesc := '白野猪';
        end;
      10:
        begin
          sMonName := '黄泉教主';
          sMonDesc := '黄泉教主';
        end;
      11:
        begin
          sMonName := '虹魔教主';
          sMonDesc := '虹魔教主';
        end;
      12:
        begin
          sMonName := '祝福油';
        end;
      13:
        begin
          sMonName := '电僵王';
          sMonDesc := '电僵王';
        end;
      14:
        begin
          sMonName := '牛魔王';
          sMonDesc := '牛魔王';
        end;
      15:
        begin
          sMonName := '魔龙教主';
          sMonDesc := '魔龙教主';
        end;
      16:
        begin
          sMonName := '双头血魔';
          sMonDesc := '双头血魔';
        end;
      17, 18:
        begin
          sMonDesc := '魔龙巨蛾';
          case Random(3) of
            0: sMonName := '魔龙巨蛾700';
            1: sMonName := '魔龙巨蛾800';
            2: sMonName := '魔龙巨蛾900';
          end;
        end;
    else
      sMonName := '';
    end;

    if nSum = 12 then
    begin
      This_Player.Give('祝福油', 1);
      This_Npc.NpcDialog(This_Player,
        '骰子的点数是 ' +
        inttostr(nDice1) + ' , ' +
        inttostr(nDice2) + ' , ' +
        inttostr(nDice3) + ' \' +
        '你从魔族指令书中得到了祝福油，这可是个很稀有的物品哦\');
    end
    else if sMonName <> '' then
    begin
      This_Npc.CreateMon('', 15, 15, 3, sMonName, 1);
      This_Npc.NpcDialog(This_Player,
        '骰子的点数是 ' +
        inttostr(nDice1) + ' , ' +
        inttostr(nDice2) + ' , ' +
        inttostr(nDice3) + ' \' +
        '魔族指令书被释放了，' + sMonDesc + '出现了，你自己小心吧\');

    end;
  end;
end;

procedure _gonext;
begin
  if CompareText(This_Player.DynRoomName, 'godforfex') = 0 then
  begin
    if This_Npc.CheckCurrMapMon > 0 then
    begin
      This_Npc.NpcDialog(This_Player,
        '怪物还没有消灭，不能释放魔族指令书');
    end
    else
    begin
      if This_Player.GetBagItemCount('魔族指令书') > 0 then
      begin
        This_Npc.NpcDialog(This_Player,
          '嗯，那我们<开始>了!');
        This_Player.Take('魔族指令书', 1);
        This_Player.SetV(0, 1, Random(6) + 1);
        This_Player.SetV(0, 2, Random(6) + 1);
        This_Player.SetV(0, 3, Random(6) + 1);
        This_Player.SetV(26, 9, 1);
        This_Npc.PlayDice(This_Player, 3, '@cube');
      end
      else
      begin
        This_Npc.NpcDialog(This_Player,
          '你没有魔族指令书，怎么能释放呢？');
      end;
    end;
  end;
end;

begin
  if This_Player.GetBagItemCount('魔族指令书') > 0 then
  begin
    This_Npc.NpcDialog(This_Player,
      '谢谢你来解救我！你的表现已经证明你是个伟大的英雄！\' +
      '但是我现在还不想回去...地下城丰富的出产，另我感到惊喜。\' +
      '我要在地下城继续收集更多材料，制作更强的盔甲。\' +
      '为了感谢你的帮助，我可以告诉你一个秘密。\' +
      '|{cmd}<返回宫殿/@goh006>          ^<打听天工神剪的秘密/@mimi>\ \' +
      '|{cmd}<退出对话/@exit>');
  end
  else
  begin
    This_Npc.NpcDialog(This_Player,
      '为了收集上等的材料，我整天出入地下城与妖魔为伍。\ \' +
      '|{cmd}<返回宫殿/@goh006> \' +
      '|{cmd}<退出对话/@exit>');
  end;
end.

